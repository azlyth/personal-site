{% extends "base.html" %}

{% block title %}Timeline - Peter @ WWW{% endblock title %}

{% block content %}

<div class="gantt-timeline">
    <!-- SVG overlay for connector lines - drawn by JavaScript -->
    <svg class="gantt-connectors"></svg>

    <!-- Column 1: Education cards + DevOpsDays talks (no overlap) -->
    <div class="gantt-education" data-mobile-title="Education">
        <div class="gantt-card" data-cat="talks" data-id="devops-seattle" data-connects-card="shipyard" data-line-offset-y="8" style="top: 15%">
            <div class="gantt-card-content">
                <h3><a href="https://www.youtube.com/watch?v=xE_nlt8Lyk4" target="_blank"><span class="yt-icon"></span> DevOpsDays Seattle</a></h3>
                <span class="years">2022</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="talks" data-id="devops-raleigh" data-connects-card="shipyard" style="top: 25%">
            <div class="gantt-card-content">
                <h3><a href="https://www.youtube.com/watch?v=bsEGCOaUsts" target="_blank"><span class="yt-icon"></span> DevOpsDays Raleigh</a></h3>
                <span class="years">2022</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="education" data-id="hunter-ba" style="top: 65%">
            <div class="gantt-card-content">
                <h3><a href="https://hunter.cuny.edu" target="_blank">Hunter College</a></h3>
                <span class="role">BA Computer Science</span>
                <span class="years">2009 - 2014</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="education" data-id="stuy" style="top: 90%">
            <div class="gantt-card-content">
                <h3><a href="https://stuy.enschool.org" target="_blank">Stuyvesant HS</a></h3>
                <span class="role">CS Program</span>
                <span class="years">2005 - 2009</span>
            </div>
        </div>
    </div>

    <!-- Column 2: Employment cards -->
    <div class="gantt-employment" data-mobile-title="Employment">
        <div class="gantt-card" data-cat="employment" data-id="botm" style="top: 0%">
            <div class="gantt-card-content">
                <h3><a href="https://bookofthemonth.com" target="_blank">Book of the Month</a></h3>
                <span class="role">Senior DevOps Engineer</span>
                <span class="years">2023 - present</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="employment" data-id="shipyard" style="top: 20%">
            <div class="gantt-card-content">
                <h3><a href="https://shipyard.build" target="_blank">Shipyard</a></h3>
                <span class="role">Cofounder & CTO</span>
                <span class="years">2018 - 2023</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="employment" data-id="lucky13" style="top: 35%">
            <div class="gantt-card-content">
                <h3>Lucky Number 13</h3>
                <span class="role">DevOps Consultant</span>
                <span class="years">2016 - 2020</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="employment" data-id="propellr" style="top: 46%">
            <div class="gantt-card-content">
                <h3><a href="https://www.crunchbase.com/organization/propellr" target="_blank">Propellr</a></h3>
                <span class="role">Lead Backend Engineer</span>
                <span class="years">2014 - 2016</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="employment" data-id="happydogs" style="top: 56%">
            <div class="gantt-card-content">
                <h3><a href="https://happydogsnyc.com" target="_blank">Happy Dogs NYC</a></h3>
                <span class="role">Software Engineer</span>
                <span class="years">2012 - 2014</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="employment" data-id="hunter-sa" style="top: 69%">
            <div class="gantt-card-content">
                <h3><a href="https://hunter.cuny.edu" target="_blank">Hunter College</a></h3>
                <span class="role">System Administrator</span>
                <span class="years">2010 - 2012</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="employment" data-id="morgan" style="top: 85%">
            <div class="gantt-card-content">
                <h3><a href="https://morganstanley.com" target="_blank">Morgan Stanley</a></h3>
                <span class="role">Intern</span>
                <span class="years">2008</span>
            </div>
        </div>
    </div>

    <!-- Column 3: Timeline center with bars -->
    <div class="gantt-center">
        <!-- Black spine line with year markers -->
        <div class="gantt-spine">
            <div class="spine-line"></div>
            <span class="year-marker" style="top: 0%">2026</span>
            <span class="year-marker" style="top: 25%">2020</span>
            <span class="year-marker" style="top: 50%">2015</span>
            <span class="year-marker" style="top: 75%">2010</span>
            <span class="year-marker" style="top: 100%">2005</span>
        </div>

        <!-- Bar columns: LEFT (Education+Overlap, Employment) | SPINE | RIGHT (Civic, Projects) -->
        <div class="gantt-bars">
            <!-- Left side bars (before spine) -->
            <div class="bars-left">
                <!-- Education column (also holds Lucky 13 overlap) -->
                <div class="bar-col education-overlap">
                    <!-- Lucky 13: 2016-2020 (blue, overlaps with Shipyard) -->
                    <div class="bar employment-bar" data-id="lucky13" style="top: 25%; height: 20%"></div>
                    <!-- Hunter BA: 2009-2014 -->
                    <div class="bar" data-id="hunter-ba" style="top: 55%; height: 24%"></div>
                    <!-- Stuyvesant: 2005-2009 -->
                    <div class="bar" data-id="stuy" style="top: 81%; height: 19%"></div>
                </div>

                <!-- Employment Primary column - Blue -->
                <div class="bar-col employment">
                    <!-- Book of Month: 2023-2025 -->
                    <div class="bar" data-id="botm" style="top: 0%; height: 9%"></div>
                    <!-- Shipyard: 2018-2023 -->
                    <div class="bar" data-id="shipyard" style="top: 11%; height: 24%"></div>
                    <!-- Propellr: 2014-2016 -->
                    <div class="bar" data-id="propellr" style="top: 46%; height: 9%"></div>
                    <!-- Happy Dogs: 2012-2014 -->
                    <div class="bar" data-id="happydogs" style="top: 56%; height: 9%"></div>
                    <!-- Hunter SysAdmin: 2010-2012 -->
                    <div class="bar" data-id="hunter-sa" style="top: 66%; height: 9%"></div>
                    <!-- Morgan Stanley: 2008 -->
                    <div class="bar" data-id="morgan" style="top: 85%; height: 5%"></div>
                </div>
            </div>

            <!-- Central spine spacer -->
            <div class="bars-spine"></div>

            <!-- Right side bars (after spine) -->
            <div class="bars-right">
                <!-- Civic column - Green -->
                <div class="bar-col civic">
                    <!-- Astoria Tech: 2019-2025 -->
                    <div class="bar" data-id="astoria" style="top: 0%; height: 30%"></div>
                    <!-- NYC Mesh: 2012-2015 -->
                    <div class="bar" data-id="nycmesh" style="top: 51%; height: 14%"></div>
                </div>

                <!-- Projects column - Orange -->
                <div class="bar-col projects">
                    <!-- Don't Die: 2025 -->
                    <div class="bar" data-id="dontdie" style="top: 0%; height: 4%"></div>
                    <!-- Lowkey: 2025 -->
                    <div class="bar" data-id="lowkey" style="top: 5%; height: 4%"></div>
                    <!-- Turtle: 2024 -->
                    <div class="bar" data-id="turtle" style="top: 10%; height: 4%"></div>
                    <!-- Snorlax: 2024 -->
                    <div class="bar" data-id="snorlax" style="top: 15%; height: 4%"></div>
                    <!-- Redub: 2017 -->
                    <div class="bar" data-id="redub" style="top: 40%; height: 4%"></div>
                    <!-- Hooks: 2016 -->
                    <div class="bar" data-id="hooks" style="top: 45%; height: 4%"></div>
                    <!-- React Native SSH: 2016 -->
                    <div class="bar" data-id="rnssh" style="top: 50%; height: 4%"></div>
                    <!-- The Grid: 2011 -->
                    <div class="bar" data-id="thegrid" style="top: 70%; height: 4%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Column 4: Projects cards -->
    <div class="gantt-projects" data-mobile-title="Projects">
        <div class="gantt-card" data-cat="projects" data-id="dontdie" style="top: 0%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/azlyth/last-one-alive" target="_blank">Don't Die</a></h3>
                <span class="years">2025</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="lowkey" style="top: 6%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/moonbeam-nyc/lowkey" target="_blank">Lowkey</a></h3>
                <span class="years">2025</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="turtle" style="top: 12%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/moonbeam-nyc/turtle" target="_blank">Turtle</a></h3>
                <span class="years">2025</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="snorlax" style="top: 18%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/moonbeam-nyc/snorlax" target="_blank">Snorlax</a></h3>
                <span class="years">2024</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="redub" style="top: 40%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/azlyth/redub" target="_blank">Redub</a></h3>
                <span class="years">2017</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="hooks" style="top: 46%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/azlyth/hooks" target="_blank">Hooks</a></h3>
                <span class="years">2016</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="rnssh" style="top: 52%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/nicklockwood/react-native-ssh" target="_blank">React Native SSH</a></h3>
                <span class="years">2016</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="thegrid" style="top: 70%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/azlyth/thegrid" target="_blank">The Grid</a></h3>
                <span class="years">2011</span>
            </div>
        </div>
    </div>

    <!-- Column 5: Civic cards -->
    <div class="gantt-civic" data-mobile-title="Civic">
        <div class="gantt-card" data-cat="civic" data-id="astoria" data-bar-connect="bottom" style="top: 24%">
            <div class="gantt-card-content">
                <h3><a href="https://astoria.app" target="_blank">Astoria Tech</a></h3>
                <span class="role">Organizer</span>
                <span class="years">2019 - present</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="civic" data-id="nycmesh" style="top: 56%">
            <div class="gantt-card-content">
                <h3><a href="https://nycmesh.net" target="_blank">NYC Mesh</a></h3>
                <span class="role">Founder</span>
                <span class="years">2012 - 2015</span>
            </div>
        </div>
    </div>

    <!-- Column 6: Talks (right side - civic related) -->
    <div class="gantt-talks gantt-talks-right" data-mobile-title="Talks">
        <div class="gantt-card" data-cat="talks" data-id="hope-2014" data-connects-card="nycmesh" style="top: 58%">
            <div class="gantt-card-content">
                <h3><a href="https://www.youtube.com/watch?v=RY-GQFueD9I" target="_blank"><span class="yt-icon"></span> HOPE X</a></h3>
                <span class="years">2014</span>
            </div>
        </div>
    </div>
</div>

<!-- Info Panel (positioned by JS) -->
<div class="info-panel" id="info-panel">
    <h4 class="info-panel-title"></h4>
    <p class="info-panel-subtitle"></p>
    <div class="info-panel-divider"></div>
    <p class="info-panel-description"></p>
</div>

<script>
// Draw connector lines from cards to their timeline bars
function drawConnectors() {
    const svg = document.querySelector('.gantt-connectors');
    const timeline = document.querySelector('.gantt-timeline');
    if (!svg || !timeline) return;

    // Clear existing paths
    svg.innerHTML = '';

    const timelineRect = timeline.getBoundingClientRect();

    // Get all cards and bars
    const cards = document.querySelectorAll('.gantt-card[data-id]');
    const colors = {
        employment: '#4a90e2',
        education: '#9b59b6',
        civic: '#2ecc71',
        projects: '#f39c12',
        talks: '#e74c3c'
    };

    cards.forEach(card => {
        const id = card.dataset.id;
        const cat = card.dataset.cat;
        const connectsCard = card.dataset.connectsCard; // For talks that connect to other cards

        // Find target - either a card (for talks) or a bar
        let target, targetRect;
        if (connectsCard) {
            target = document.querySelector(`.gantt-card[data-id="${connectsCard}"]`);
            if (!target) return;
            targetRect = target.getBoundingClientRect();
        } else {
            target = document.querySelector(`.bar[data-id="${id}"]`);
            if (!target) return;
            targetRect = target.getBoundingClientRect();
        }

        const cardRect = card.getBoundingClientRect();

        // Calculate positions relative to timeline container
        const isLeft = card.closest('.gantt-education') !== null ||
                       card.closest('.gantt-employment') !== null ||
                       card.closest('.gantt-talks-left') !== null;

        let cardX, cardY, targetX, targetY;

        // Offset to push dot away from text
        const dotOffset = 12;

        // Custom Y offset for line start (from data attribute)
        const lineOffsetY = parseInt(card.dataset.lineOffsetY) || 0;

        if (connectsCard) {
            // Talk connecting to another card - diagonal line to center of target card
            if (isLeft) {
                // Left talk connecting to a card on its right
                cardX = cardRect.right - timelineRect.left + dotOffset;
                cardY = cardRect.top - timelineRect.top + 10 + lineOffsetY;
                targetX = targetRect.left - timelineRect.left - dotOffset;
                // Connect to vertical center of target card
                targetY = targetRect.top - timelineRect.top + targetRect.height / 2;
            } else {
                // Right talk connecting to a card on its left
                cardX = cardRect.left - timelineRect.left - dotOffset;
                cardY = cardRect.top - timelineRect.top + 10 + lineOffsetY;
                targetX = targetRect.right - timelineRect.left + dotOffset;
                // Connect to vertical center of target card
                targetY = targetRect.top - timelineRect.top + targetRect.height / 2;
            }
        } else if (isLeft) {
            // Left card: connect from right edge of card to center of bar
            cardX = cardRect.right - timelineRect.left + dotOffset;
            cardY = cardRect.top - timelineRect.top + 10; // Offset to title area
            targetX = targetRect.left - timelineRect.left + targetRect.width / 2;
            // Connect to bar - check for custom connection point
            const barConnect = card.dataset.barConnect;
            if (barConnect === 'bottom') {
                targetY = targetRect.top - timelineRect.top + targetRect.height - 3;
            } else {
                targetY = targetRect.top - timelineRect.top + targetRect.height / 2;
            }
        } else {
            // Right card: connect from left edge of card to center of bar
            cardX = cardRect.left - timelineRect.left - dotOffset;
            cardY = cardRect.top - timelineRect.top + 10;
            targetX = targetRect.left - timelineRect.left + targetRect.width / 2;
            // Connect to bar - check for custom connection point
            const barConnect = card.dataset.barConnect;
            if (barConnect === 'bottom') {
                // Horizontal line at card's Y level, connecting to 80% down the bar
                targetY = cardY;
            } else {
                targetY = targetRect.top - timelineRect.top + targetRect.height / 2;
            }
        }

        // Create the path
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', `M ${cardX} ${cardY} L ${targetX} ${targetY}`);
        path.setAttribute('stroke', colors[cat]);
        path.setAttribute('stroke-width', '1.5');
        path.setAttribute('fill', 'none');
        path.setAttribute('data-from', id);

        // Talks get dashed lines and lower opacity
        if (cat === 'talks') {
            path.setAttribute('stroke-dasharray', '3,2');
            path.setAttribute('opacity', '0.6');
        } else {
            path.setAttribute('opacity', '0.5');
        }

        // Add endpoint circles
        const cardDot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        cardDot.setAttribute('cx', cardX);
        cardDot.setAttribute('cy', cardY);
        cardDot.setAttribute('r', cat === 'talks' ? '2.5' : '3');
        cardDot.setAttribute('fill', colors[cat]);
        cardDot.setAttribute('data-from', id);

        const targetDot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        targetDot.setAttribute('cx', targetX);
        targetDot.setAttribute('cy', targetY);
        targetDot.setAttribute('r', cat === 'talks' ? '2.5' : '3');
        targetDot.setAttribute('fill', colors[cat]);
        targetDot.setAttribute('data-from', id);

        svg.appendChild(path);
        svg.appendChild(cardDot);
        svg.appendChild(targetDot);
    });
}

// Run on load and resize
window.addEventListener('load', drawConnectors);
window.addEventListener('resize', drawConnectors);
// Also run after a short delay to ensure layout is complete
setTimeout(drawConnectors, 100);

// Hover highlighting
function setupHoverHighlighting() {
    const timeline = document.querySelector('.gantt-timeline');
    const cards = document.querySelectorAll('.gantt-card[data-id]');
    const bars = document.querySelectorAll('.bar[data-id]');

    function clearHighlights() {
        timeline.classList.remove('has-hover');
        document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
    }

    function highlightChain(card) {
        timeline.classList.add('has-hover');
        const id = card.dataset.id;
        const connectsCard = card.dataset.connectsCard;

        // Highlight the hovered card
        card.classList.add('highlight');

        // Highlight its bar (if it has one)
        const bar = document.querySelector(`.bar[data-id="${id}"]`);
        if (bar) bar.classList.add('highlight');

        // Highlight connector lines for this card
        document.querySelectorAll(`.gantt-connectors path[data-from="${id}"], .gantt-connectors circle[data-from="${id}"]`).forEach(el => {
            el.classList.add('highlight');
        });

        // If it's a talk that connects to another card, highlight that chain too
        if (connectsCard) {
            const targetCard = document.querySelector(`.gantt-card[data-id="${connectsCard}"]`);
            if (targetCard) {
                targetCard.classList.add('highlight');
                // And highlight the target's bar
                const targetBar = document.querySelector(`.bar[data-id="${connectsCard}"]`);
                if (targetBar) targetBar.classList.add('highlight');
                // And the target's connector lines
                document.querySelectorAll(`.gantt-connectors path[data-from="${connectsCard}"], .gantt-connectors circle[data-from="${connectsCard}"]`).forEach(el => {
                    el.classList.add('highlight');
                });
            }
        }

        // Also highlight any talks that connect to this card (reverse direction)
        document.querySelectorAll(`.gantt-card[data-connects-card="${id}"]`).forEach(talk => {
            talk.classList.add('highlight');
            const talkId = talk.dataset.id;
            document.querySelectorAll(`.gantt-connectors path[data-from="${talkId}"], .gantt-connectors circle[data-from="${talkId}"]`).forEach(el => {
                el.classList.add('highlight');
            });
        });
    }

    function highlightBar(bar) {
        timeline.classList.add('has-hover');
        const id = bar.dataset.id;

        // Highlight the bar
        bar.classList.add('highlight');

        // Highlight its card
        const card = document.querySelector(`.gantt-card[data-id="${id}"]`);
        if (card) card.classList.add('highlight');

        // Highlight connector lines
        document.querySelectorAll(`.gantt-connectors path[data-from="${id}"], .gantt-connectors circle[data-from="${id}"]`).forEach(el => {
            el.classList.add('highlight');
        });

        // Also highlight any talks that connect to this card
        document.querySelectorAll(`.gantt-card[data-connects-card="${id}"]`).forEach(talk => {
            talk.classList.add('highlight');
            const talkId = talk.dataset.id;
            document.querySelectorAll(`.gantt-connectors path[data-from="${talkId}"], .gantt-connectors circle[data-from="${talkId}"]`).forEach(el => {
                el.classList.add('highlight');
            });
        });
    }

    cards.forEach(card => {
        card.addEventListener('mouseenter', () => highlightChain(card));
        card.addEventListener('mouseleave', clearHighlights);
    });

    bars.forEach(bar => {
        bar.addEventListener('mouseenter', () => highlightBar(bar));
        bar.addEventListener('mouseleave', clearHighlights);
    });
}

window.addEventListener('load', setupHoverHighlighting);

// Info Panel content data
const panelContent = {
    // Employment
    'botm': {
        title: 'Book of the Month',
        subtitle: 'Senior DevOps Engineer • 2023 - present',
        description: '<div class="info-panel-site"><a href="https://bookofthemonth.com" target="_blank"><img src="/timeline-items/botm.png" alt="Book of the Month" loading="lazy"></a></div><ul><li>Lead platform, infrastructure, and SRE initiatives supporting consumer-facing e-commerce systems with 500M+ monthly requests</li><li>Built Kubernetes developer platform using ArgoCD and Crossplane for self-service infrastructure provisioning</li><li>Implemented ephemeral preview environments with 4-minute build times</li><li>Introduced GitOps workflows and infrastructure-as-code practices across the engineering organization</li><li>Manage production infrastructure on AWS with focus on reliability, observability, and cost optimization</li></ul><p class="info-panel-link"><a href="https://bookofthemonth.com" target="_blank">Visit website →</a></p>'
    },
    'shipyard': {
        title: 'Shipyard',
        subtitle: 'Cofounder & CTO • 2018 - 2023',
        description: '<div class="info-panel-site"><iframe src="https://shipyard.build" loading="lazy"></iframe></div><ul><li>Co-founded and built full MVP of Kubernetes-backed ephemeral environments platform</li><li>Designed entire initial architecture: custom K8s controllers, Helm charts, Terraform, Python/Golang microservices</li><li>Built CI/CD integrations for GitHub, GitLab, and Bitbucket</li><li>Led 7-person engineering team through multiple funding rounds</li><li>Grew platform to serve dozens of companies running thousands of ephemeral environments monthly</li><li>Spoke at DevOpsDays conferences about ephemeral environments and developer experience</li></ul><p class="info-panel-link"><a href="https://shipyard.build" target="_blank">Visit website →</a></p>'
    },
    'lucky13': {
        title: 'Lucky Number 13',
        subtitle: 'DevOps Consultant • 2016 - 2020',
        description: '<ul><li>Independent DevOps consulting practice serving ML, CAD, and IoT companies</li><li>Built self-hosted Jupyter notebook environments for data science teams</li><li>Designed Python microservices architectures and production Kubernetes clusters on GCP</li><li>Helped early-stage startups establish cloud infrastructure foundations and CI/CD pipelines</li></ul>'
    },
    'propellr': {
        title: 'Propellr',
        subtitle: 'Lead Backend Engineer • 2014 - 2016',
        description: '<div class="info-panel-site"><a href="https://www.crunchbase.com/organization/propellr" target="_blank"><img src="/timeline-items/propellr.png" alt="Propellr" loading="lazy"></a></div><ul><li>Led engineering for fintech platform connecting real estate developers with investors</li><li>Built Python/Flask backends, Angular frontends, and AWS deployment pipelines</li><li>Introduced infrastructure automation via Ansible — company\'s first reproducible deployments</li><li>Worked directly with founders to translate business requirements into technical architecture</li></ul><p class="info-panel-link"><a href="https://www.crunchbase.com/organization/propellr" target="_blank">View on Crunchbase →</a></p>'
    },
    'happydogs': {
        title: 'Happy Dogs NYC',
        subtitle: 'Software Engineer • 2012 - 2014',
        description: '<div class="info-panel-site"><iframe src="https://happydogsnyc.com" loading="lazy"></iframe></div><ul><li>Sole developer for internal operations system serving dog daycare chain across multiple NYC locations</li><li>Built Django backend handling scheduling, client management, and billing</li><li>Deployed and maintained application on DigitalOcean</li></ul><p class="info-panel-link"><a href="https://happydogsnyc.com" target="_blank">Visit website →</a></p>'
    },
    'hunter-sa': {
        title: 'Hunter College',
        subtitle: 'System Administrator • 2010 - 2012',
        description: '<div class="info-panel-site"><iframe src="https://hunter.cuny.edu" loading="lazy"></iframe></div><ul><li>One of six sysadmins managing IT infrastructure for 60,000+ students and faculty</li><li>Managed DNS, Active Directory, LDAP, email infrastructure, and campus website</li><li>Gained enterprise-scale systems administration experience while completing CS degree</li></ul><p class="info-panel-link"><a href="https://hunter.cuny.edu" target="_blank">Visit website →</a></p>'
    },
    'morgan': {
        title: 'Morgan Stanley',
        subtitle: 'Software Engineering Intern • 2008',
        description: '<div class="info-panel-site"><a href="https://morganstanley.com" target="_blank"><img src="/timeline-items/morgan-stanley.png" alt="Morgan Stanley" loading="lazy"></a></div><ul><li>Summer internship in technology division</li><li>Built AJAX-powered dynamic content loading for internal web application</li><li>First exposure to professional development practices and enterprise-scale systems</li></ul><p class="info-panel-link"><a href="https://morganstanley.com" target="_blank">Visit website →</a></p>'
    },
    // Education
    'hunter-ba': {
        title: 'Hunter College',
        subtitle: 'BA Computer Science • 2009 - 2014',
        description: '<div class="info-panel-site"><iframe src="https://hunter.cuny.edu" loading="lazy"></iframe></div><ul><li>Bachelor of Arts in Computer Science</li><li>Part of City University of New York (CUNY) system</li><li>Worked as system administrator on campus while completing degree</li></ul><p class="info-panel-link"><a href="https://hunter.cuny.edu" target="_blank">Visit website →</a></p>'
    },
    'stuy': {
        title: 'Stuyvesant High School',
        subtitle: 'CS Program • 2005 - 2009',
        description: '<div class="info-panel-site"><a href="https://stuy.enschool.org" target="_blank"><img src="/timeline-items/stuy.png" alt="Stuyvesant High School" loading="lazy"></a></div><ul><li>One of NYC\'s nine specialized public high schools</li><li>Competitive entrance exam required</li><li>Participated in Computer Science program</li></ul><p class="info-panel-link"><a href="https://stuy.enschool.org" target="_blank">Visit website →</a></p>'
    },
    // Projects
    'dontdie': {
        title: 'Don\'t Die',
        subtitle: 'Personal Project • 2025',
        description: '<ul><li>Jackbox-style zombie dice party game for in-person play</li><li>One device hosts, others join via phone browser — no app download required</li><li>Built with React Native with real-time WebSocket communication</li></ul><p class="info-panel-link"><a href="https://github.com/azlyth/last-one-alive" target="_blank"><i class="fa-brands fa-github"></i>View on GitHub →</a></p>'
    },
    'lowkey': {
        title: 'Lowkey',
        subtitle: 'Open Source • 2025',
        description: '<ul><li>Node.js CLI for managing secrets across multiple backends</li><li>Syncs between AWS Secrets Manager, Kubernetes Secrets, .env files, and JSON</li><li>Interactive terminal browser with fuzzy search and live editing</li></ul><p class="info-panel-link"><a href="https://github.com/moonbeam-nyc/lowkey" target="_blank"><i class="fa-brands fa-github"></i>View on GitHub →</a></p>'
    },
    'turtle': {
        title: 'Turtle',
        subtitle: 'Open Source • 2025',
        description: '<ul><li>Self-hosted web app for browser-based terminal access and runnable runbooks</li><li>Real-time WebSocket streaming, YAML runbook definitions</li><li>Single-container deployment for DevOps and incident response</li></ul><p class="info-panel-link"><a href="https://github.com/moonbeam-nyc/turtle" target="_blank"><i class="fa-brands fa-github"></i>View on GitHub →</a></p>'
    },
    'snorlax': {
        title: 'Snorlax',
        subtitle: 'Open Source • 2024',
        description: '<ul><li>Kubernetes Operator that sleeps/wakes Deployments and Ingresses on schedules</li><li>Implemented in Golang using controller-runtime library</li><li>Cost-savings tool to scale down non-production environments during off-hours</li></ul><p class="info-panel-link"><a href="https://github.com/moonbeam-nyc/snorlax" target="_blank"><i class="fa-brands fa-github"></i>View on GitHub →</a></p>'
    },
    'redub': {
        title: 'Redub',
        subtitle: 'Personal Project • 2017',
        description: '<ul><li>Desktop app for redubbing audio in videos</li><li>Load video with SRT subtitles, record new audio per segment, export with replaced audio</li><li>Built with Electron and React</li></ul><p class="info-panel-link"><a href="https://github.com/azlyth/redub" target="_blank"><i class="fa-brands fa-github"></i>View on GitHub →</a></p>'
    },
    'hooks': {
        title: 'Hooks',
        subtitle: 'Personal Project • 2016',
        description: '<ul><li>React Native mobile app for running scripts on remote servers via SSH</li><li>List servers and scripts, tap to run, see real-time output on phone</li><li>No server-side installation required — just SSH access</li></ul><p class="info-panel-link"><a href="https://github.com/azlyth/hooks" target="_blank"><i class="fa-brands fa-github"></i>View on GitHub →</a></p>'
    },
    'rnssh': {
        title: 'React Native SSH',
        subtitle: 'Open Source • 2016',
        description: '<ul><li>SSH client component for React Native applications</li><li>Native SSH connectivity for iOS and Android</li><li>Built as dependency for Hooks app, released as open source</li></ul><p class="info-panel-link"><a href="https://github.com/nicklockwood/react-native-ssh" target="_blank"><i class="fa-brands fa-github"></i>View on GitHub →</a></p>'
    },
    'thegrid': {
        title: 'The Grid',
        subtitle: 'Personal Project • 2011',
        description: '<ul><li>Real-time multiplayer HTML5 canvas experiment</li><li>Multiple browser clients connect to shared world via WebSockets</li><li>Built with Node.js and Socket.io</li></ul><p class="info-panel-link"><a href="https://github.com/azlyth/thegrid" target="_blank"><i class="fa-brands fa-github"></i>View on GitHub →</a></p>'
    },
    // Civic
    'astoria': {
        title: 'Astoria Tech',
        subtitle: 'Founder & Organizer • 2019 - present',
        description: '<div class="info-panel-site"><iframe src="https://astoria.app" loading="lazy"></iframe></div><ul><li>Founded neighborhood tech community meetup in Astoria, Queens</li><li>Running 6+ years with monthly events — talks, demos, and networking</li><li>Manage astoria.app website, coordinate speakers, host at local venues</li></ul><p class="info-panel-link"><a href="https://astoria.app" target="_blank">Visit website →</a></p>'
    },
    'nycmesh': {
        title: 'NYC Mesh',
        subtitle: 'Founder • 2012 - 2015',
        description: '<div class="info-panel-site"><iframe src="https://nycmesh.net" loading="lazy"></iframe></div><ul><li>Founded and built early technical foundation of community-owned ISP</li><li>Organized initial volunteers, established network architecture, deployed first nodes</li><li>Now grown to 1,200+ nodes providing internet across NYC</li></ul><p class="info-panel-link"><a href="https://nycmesh.net" target="_blank">Visit website →</a></p>'
    },
    // Talks
    'devops-seattle': {
        title: 'DevOpsDays Seattle 2022',
        subtitle: 'Conference Talk • 2022',
        description: '<div class="info-panel-video"><iframe src="https://www.youtube.com/embed/xE_nlt8Lyk4" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div><ul><li>Presented on ephemeral environments and developer experience</li><li>Shared lessons from building Shipyard</li><li>Covered preview environments for faster feedback loops</li></ul><p class="info-panel-link"><a href="https://www.youtube.com/watch?v=xE_nlt8Lyk4" target="_blank">Watch on YouTube →</a></p>'
    },
    'devops-raleigh': {
        title: 'DevOpsDays Raleigh 2022',
        subtitle: 'Conference Talk • 2022',
        description: '<div class="info-panel-video"><iframe src="https://www.youtube.com/embed/bsEGCOaUsts" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div><ul><li>Spoke on building preview environments for development teams</li><li>Covered technical architecture behind ephemeral environments</li><li>Discussed cultural changes needed for effective adoption</li></ul><p class="info-panel-link"><a href="https://www.youtube.com/watch?v=bsEGCOaUsts" target="_blank">Watch on YouTube →</a></p>'
    },
    'hope-2014': {
        title: 'HOPE X 2014',
        subtitle: 'Conference Talk • 2014',
        description: '<div class="info-panel-video"><iframe src="https://www.youtube.com/embed/RY-GQFueD9I" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div><ul><li>Presented at Hackers On Planet Earth conference</li><li>Discussed NYC Mesh and building community wireless networks</li><li>Covered mesh networking protocols and decentralized communication</li></ul><p class="info-panel-link"><a href="https://www.youtube.com/watch?v=RY-GQFueD9I" target="_blank">Watch on YouTube →</a></p>'
    }
};

// Info Panel functionality
function setupInfoPanel() {
    const panel = document.getElementById('info-panel');
    const timeline = document.querySelector('.gantt-timeline');
    const cards = document.querySelectorAll('.gantt-card[data-id]');
    const bars = document.querySelectorAll('.bar[data-id]');

    if (!panel) return;

    let hideTimeout;
    let currentId = null;
    let isPinned = false;

    function showPanel(element, id, pin = false) {
        const content = panelContent[id];
        if (!content) return;

        clearTimeout(hideTimeout);
        currentId = id;

        if (pin) {
            isPinned = true;
            panel.classList.add('pinned');
        }

        // Determine if element is on left or right side
        const isLeft = element.closest('.gantt-education') !== null ||
                       element.closest('.gantt-employment') !== null ||
                       element.closest('.gantt-talks-left') !== null ||
                       element.closest('.bars-left') !== null;

        // Get element position
        const rect = element.getBoundingClientRect();
        const cat = element.dataset.cat || element.closest('.bar-col')?.classList[1] || 'employment';

        // Populate panel
        panel.querySelector('.info-panel-title').textContent = content.title;
        panel.querySelector('.info-panel-subtitle').textContent = content.subtitle;
        panel.querySelector('.info-panel-description').innerHTML = content.description;
        panel.setAttribute('data-cat', cat);
        panel.setAttribute('data-side', isLeft ? 'left' : 'right');

        // Position panel adjacent to the element
        const panelWidth = 320;
        const gap = 10;
        const margin = 20;
        let left, top;

        if (isLeft) {
            // Show panel to the left of the element
            left = rect.left - panelWidth - gap;
            // If panel would go off-screen left, show it on the right instead
            if (left < margin) {
                left = rect.right + gap;
            }
            panel.classList.remove('from-right');
            panel.classList.add('from-left');
        } else {
            // Show panel to the right of the element
            left = rect.right + gap;
            // If panel would go off-screen right, show it on the left instead
            if (left + panelWidth > window.innerWidth - margin) {
                left = rect.left - panelWidth - gap;
            }
            panel.classList.remove('from-left');
            panel.classList.add('from-right');
        }

        // Vertical position: align with element, but keep panel fully visible
        // Estimate panel height (with iframe ~180px + content ~200px + padding)
        const estimatedPanelHeight = 450;
        top = rect.top - 20;
        top = Math.max(margin, Math.min(top, window.innerHeight - estimatedPanelHeight));

        panel.style.left = left + 'px';
        panel.style.top = top + 'px';

        // Show with animation
        requestAnimationFrame(() => {
            panel.classList.add('visible');
        });

        // Keep highlight active
        highlightById(id);
    }

    function hidePanel(force = false) {
        if (isPinned && !force) return;

        hideTimeout = setTimeout(() => {
            if (!isPinned) {
                panel.classList.remove('visible');
                currentId = null;
                clearHighlightsGlobal();
            }
        }, 150);
    }

    function unpinPanel() {
        isPinned = false;
        panel.classList.remove('pinned');
        panel.classList.remove('visible');
        currentId = null;
        clearHighlightsGlobal();
    }

    // Helper to highlight by ID (reuse existing highlight logic)
    function highlightById(id) {
        timeline.classList.add('has-hover');

        // Clear existing highlights
        document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));

        // Highlight card
        const card = document.querySelector(`.gantt-card[data-id="${id}"]`);
        if (card) {
            card.classList.add('highlight');
            const connectsCard = card.dataset.connectsCard;
            if (connectsCard) {
                const targetCard = document.querySelector(`.gantt-card[data-id="${connectsCard}"]`);
                if (targetCard) targetCard.classList.add('highlight');
                const targetBar = document.querySelector(`.bar[data-id="${connectsCard}"]`);
                if (targetBar) targetBar.classList.add('highlight');
                document.querySelectorAll(`.gantt-connectors path[data-from="${connectsCard}"], .gantt-connectors circle[data-from="${connectsCard}"]`).forEach(el => el.classList.add('highlight'));
            }
        }

        // Highlight bar
        const bar = document.querySelector(`.bar[data-id="${id}"]`);
        if (bar) bar.classList.add('highlight');

        // Highlight connectors
        document.querySelectorAll(`.gantt-connectors path[data-from="${id}"], .gantt-connectors circle[data-from="${id}"]`).forEach(el => el.classList.add('highlight'));

        // Highlight talks that connect to this item
        document.querySelectorAll(`.gantt-card[data-connects-card="${id}"]`).forEach(talk => {
            talk.classList.add('highlight');
            const talkId = talk.dataset.id;
            document.querySelectorAll(`.gantt-connectors path[data-from="${talkId}"], .gantt-connectors circle[data-from="${talkId}"]`).forEach(el => el.classList.add('highlight'));
        });
    }

    function clearHighlightsGlobal() {
        timeline.classList.remove('has-hover');
        document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
    }

    // Keep panel open when hovering over it
    panel.addEventListener('mouseenter', () => {
        clearTimeout(hideTimeout);
    });

    panel.addEventListener('mouseleave', () => {
        if (!isPinned) {
            hidePanel();
        }
    });

    // Click outside to unpin
    document.addEventListener('click', (e) => {
        if (isPinned && !panel.contains(e.target) && !e.target.closest('.gantt-card') && !e.target.closest('.bar')) {
            unpinPanel();
        }
    });

    // Attach to cards
    cards.forEach(card => {
        const id = card.dataset.id;

        card.addEventListener('mouseenter', () => {
            if (!isPinned) {
                showPanel(card, id);
            }
        });

        card.addEventListener('mouseleave', () => {
            if (!isPinned) {
                hidePanel();
            }
        });

        // Click to pin
        card.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();

            if (isPinned && currentId === id) {
                // Clicking same item unpins
                unpinPanel();
            } else {
                // Pin to this item
                if (isPinned) {
                    // Switch to new item
                    isPinned = false;
                    panel.classList.remove('pinned');
                }
                showPanel(card, id, true);
            }
        });
    });

}

window.addEventListener('load', setupInfoPanel);
</script>

{% endblock content %}
