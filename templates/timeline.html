{% extends "base.html" %}

{% block title %}Timeline - Peter @ WWW{% endblock title %}

{% block content %}
<h1>Timeline</h1>

<div class="timeline-legend">
    <span class="leg-talks">Talks</span>
    <span class="leg-education">Education</span>
    <span class="leg-employment">Employment</span>
    <span class="leg-civic">Civic</span>
    <span class="leg-projects">Projects</span>
</div>

<div class="gantt-timeline">
    <!-- SVG overlay for connector lines - drawn by JavaScript -->
    <svg class="gantt-connectors"></svg>

    <!-- Column 1: Education cards + DevOpsDays talks (no overlap) -->
    <div class="gantt-education">
        <div class="gantt-card" data-cat="talks" data-id="devops-seattle" data-connects-card="shipyard" data-line-offset-y="8" style="top: 15%">
            <div class="gantt-card-content">
                <h3><a href="https://www.youtube.com/watch?v=xE_nlt8Lyk4" target="_blank"><span class="yt-icon"></span> DevOpsDays Seattle</a></h3>
                <span class="years">2022</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="talks" data-id="devops-raleigh" data-connects-card="shipyard" style="top: 25%">
            <div class="gantt-card-content">
                <h3><a href="https://www.youtube.com/watch?v=bsEGCOaUsts" target="_blank"><span class="yt-icon"></span> DevOpsDays Raleigh</a></h3>
                <span class="years">2022</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="education" data-id="hunter-ba" style="top: 65%">
            <div class="gantt-card-content">
                <h3><a href="https://hunter.cuny.edu" target="_blank">Hunter College</a></h3>
                <span class="role">BA Computer Science</span>
                <span class="years">2009 - 2014</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="education" data-id="stuy" style="top: 90%">
            <div class="gantt-card-content">
                <h3><a href="https://stuy.enschool.org" target="_blank">Stuyvesant HS</a></h3>
                <span class="role">CS Program</span>
                <span class="years">2005 - 2009</span>
            </div>
        </div>
    </div>

    <!-- Column 2: Employment cards -->
    <div class="gantt-employment">
        <div class="gantt-card" data-cat="employment" data-id="botm" style="top: 0%">
            <div class="gantt-card-content">
                <h3><a href="https://www.bookofthemonth.com" target="_blank">Book of the Month</a></h3>
                <span class="role">Senior DevOps Engineer</span>
                <span class="years">2023 - present</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="employment" data-id="shipyard" style="top: 20%">
            <div class="gantt-card-content">
                <h3><a href="https://shipyard.build" target="_blank">Shipyard</a></h3>
                <span class="role">Cofounder & CTO</span>
                <span class="years">2018 - 2023</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="employment" data-id="lucky13" style="top: 35%">
            <div class="gantt-card-content">
                <h3>Lucky Number 13</h3>
                <span class="role">DevOps Consultant</span>
                <span class="years">2016 - 2020</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="employment" data-id="propellr" style="top: 46%">
            <div class="gantt-card-content">
                <h3><a href="https://www.crunchbase.com/organization/propellr" target="_blank">Propellr</a></h3>
                <span class="role">Lead Backend Engineer</span>
                <span class="years">2014 - 2016</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="employment" data-id="happydogs" style="top: 56%">
            <div class="gantt-card-content">
                <h3><a href="https://happydogsnyc.com" target="_blank">Happy Dogs NYC</a></h3>
                <span class="role">Software Engineer</span>
                <span class="years">2012 - 2014</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="employment" data-id="hunter-sa" style="top: 69%">
            <div class="gantt-card-content">
                <h3><a href="https://hunter.cuny.edu" target="_blank">Hunter College</a></h3>
                <span class="role">System Administrator</span>
                <span class="years">2010 - 2012</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="employment" data-id="morgan" style="top: 85%">
            <div class="gantt-card-content">
                <h3><a href="https://www.morganstanley.com" target="_blank">Morgan Stanley</a></h3>
                <span class="role">Intern</span>
                <span class="years">2008</span>
            </div>
        </div>
    </div>

    <!-- Column 3: Timeline center with bars -->
    <div class="gantt-center">
        <!-- Black spine line with year markers -->
        <div class="gantt-spine">
            <div class="spine-line"></div>
            <span class="year-marker" style="top: 0%">2025</span>
            <span class="year-marker" style="top: 25%">2020</span>
            <span class="year-marker" style="top: 50%">2015</span>
            <span class="year-marker" style="top: 75%">2010</span>
            <span class="year-marker" style="top: 100%">2005</span>
        </div>

        <!-- Bar columns: LEFT (Education+Overlap, Employment) | SPINE | RIGHT (Civic, Projects) -->
        <div class="gantt-bars">
            <!-- Left side bars (before spine) -->
            <div class="bars-left">
                <!-- Education column (also holds Lucky 13 overlap) -->
                <div class="bar-col education-overlap">
                    <!-- Lucky 13: 2016-2020 (blue, overlaps with Shipyard) -->
                    <div class="bar employment-bar" data-id="lucky13" style="top: 25%; height: 20%"></div>
                    <!-- Hunter BA: 2009-2014 -->
                    <div class="bar" data-id="hunter-ba" style="top: 55%; height: 24%"></div>
                    <!-- Stuyvesant: 2005-2009 -->
                    <div class="bar" data-id="stuy" style="top: 81%; height: 19%"></div>
                </div>

                <!-- Employment Primary column - Blue -->
                <div class="bar-col employment">
                    <!-- Book of Month: 2023-2025 -->
                    <div class="bar" data-id="botm" style="top: 0%; height: 9%"></div>
                    <!-- Shipyard: 2018-2023 -->
                    <div class="bar" data-id="shipyard" style="top: 11%; height: 24%"></div>
                    <!-- Propellr: 2014-2016 -->
                    <div class="bar" data-id="propellr" style="top: 46%; height: 9%"></div>
                    <!-- Happy Dogs: 2012-2014 -->
                    <div class="bar" data-id="happydogs" style="top: 56%; height: 9%"></div>
                    <!-- Hunter SysAdmin: 2010-2012 -->
                    <div class="bar" data-id="hunter-sa" style="top: 66%; height: 9%"></div>
                    <!-- Morgan Stanley: 2008 -->
                    <div class="bar" data-id="morgan" style="top: 85%; height: 5%"></div>
                </div>
            </div>

            <!-- Central spine spacer -->
            <div class="bars-spine"></div>

            <!-- Right side bars (after spine) -->
            <div class="bars-right">
                <!-- Civic column - Green -->
                <div class="bar-col civic">
                    <!-- Astoria Tech: 2019-2025 -->
                    <div class="bar" data-id="astoria" style="top: 0%; height: 30%"></div>
                    <!-- NYC Mesh: 2012-2015 -->
                    <div class="bar" data-id="nycmesh" style="top: 51%; height: 14%"></div>
                </div>

                <!-- Projects column - Orange -->
                <div class="bar-col projects">
                    <!-- Don't Die: 2025 -->
                    <div class="bar" data-id="dontdie" style="top: 0%; height: 4%"></div>
                    <!-- Lowkey: 2025 -->
                    <div class="bar" data-id="lowkey" style="top: 5%; height: 4%"></div>
                    <!-- Turtle: 2024 -->
                    <div class="bar" data-id="turtle" style="top: 10%; height: 4%"></div>
                    <!-- Snorlax: 2024 -->
                    <div class="bar" data-id="snorlax" style="top: 15%; height: 4%"></div>
                    <!-- Redub: 2017 -->
                    <div class="bar" data-id="redub" style="top: 40%; height: 4%"></div>
                    <!-- Hooks: 2016 -->
                    <div class="bar" data-id="hooks" style="top: 45%; height: 4%"></div>
                    <!-- React Native SSH: 2016 -->
                    <div class="bar" data-id="rnssh" style="top: 50%; height: 4%"></div>
                    <!-- The Grid: 2011 -->
                    <div class="bar" data-id="thegrid" style="top: 70%; height: 4%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Column 4: Projects cards -->
    <div class="gantt-projects">
        <div class="gantt-card" data-cat="projects" data-id="dontdie" style="top: 0%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/azlyth/last-one-alive" target="_blank">Don't Die</a></h3>
                <span class="years">2025</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="lowkey" style="top: 6%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/moonbeam-nyc/lowkey" target="_blank">Lowkey</a></h3>
                <span class="years">2025</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="turtle" style="top: 12%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/moonbeam-nyc/turtle" target="_blank">Turtle</a></h3>
                <span class="years">2025</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="snorlax" style="top: 18%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/moonbeam-nyc/snorlax" target="_blank">Snorlax</a></h3>
                <span class="years">2024</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="redub" style="top: 40%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/azlyth/redub" target="_blank">Redub</a></h3>
                <span class="years">2017</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="hooks" style="top: 46%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/azlyth/hooks" target="_blank">Hooks</a></h3>
                <span class="years">2016</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="rnssh" style="top: 52%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/nicklockwood/react-native-ssh" target="_blank">React Native SSH</a></h3>
                <span class="years">2016</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="projects" data-id="thegrid" style="top: 70%">
            <div class="gantt-card-content">
                <h3><a href="https://github.com/azlyth/thegrid" target="_blank">The Grid</a></h3>
                <span class="years">2011</span>
            </div>
        </div>
    </div>

    <!-- Column 5: Civic cards -->
    <div class="gantt-civic">
        <div class="gantt-card" data-cat="civic" data-id="astoria" style="top: 14%">
            <div class="gantt-card-content">
                <h3><a href="https://astoria.app" target="_blank">Astoria Tech</a></h3>
                <span class="role">Organizer</span>
                <span class="years">2019 - present</span>
            </div>
        </div>

        <div class="gantt-card" data-cat="civic" data-id="nycmesh" style="top: 58%">
            <div class="gantt-card-content">
                <h3><a href="https://nycmesh.net" target="_blank">NYC Mesh</a></h3>
                <span class="role">Founder</span>
                <span class="years">2012 - 2015</span>
            </div>
        </div>
    </div>

    <!-- Column 6: Talks (right side - civic related) -->
    <div class="gantt-talks gantt-talks-right">
        <div class="gantt-card" data-cat="talks" data-id="hope-2014" data-connects-card="nycmesh" style="top: 58%">
            <div class="gantt-card-content">
                <h3><a href="https://www.youtube.com/watch?v=RY-GQFueD9I" target="_blank"><span class="yt-icon"></span> HOPE X</a></h3>
                <span class="years">2014</span>
            </div>
        </div>
    </div>
</div>

<script>
// Draw connector lines from cards to their timeline bars
function drawConnectors() {
    const svg = document.querySelector('.gantt-connectors');
    const timeline = document.querySelector('.gantt-timeline');
    if (!svg || !timeline) return;

    // Clear existing paths
    svg.innerHTML = '';

    const timelineRect = timeline.getBoundingClientRect();

    // Get all cards and bars
    const cards = document.querySelectorAll('.gantt-card[data-id]');
    const colors = {
        employment: '#4a90e2',
        education: '#9b59b6',
        civic: '#2ecc71',
        projects: '#f39c12',
        talks: '#e74c3c'
    };

    cards.forEach(card => {
        const id = card.dataset.id;
        const cat = card.dataset.cat;
        const connectsCard = card.dataset.connectsCard; // For talks that connect to other cards

        // Find target - either a card (for talks) or a bar
        let target, targetRect;
        if (connectsCard) {
            target = document.querySelector(`.gantt-card[data-id="${connectsCard}"]`);
            if (!target) return;
            targetRect = target.getBoundingClientRect();
        } else {
            target = document.querySelector(`.bar[data-id="${id}"]`);
            if (!target) return;
            targetRect = target.getBoundingClientRect();
        }

        const cardRect = card.getBoundingClientRect();

        // Calculate positions relative to timeline container
        const isLeft = card.closest('.gantt-education') !== null ||
                       card.closest('.gantt-employment') !== null ||
                       card.closest('.gantt-talks-left') !== null;

        let cardX, cardY, targetX, targetY;

        // Offset to push dot away from text
        const dotOffset = 12;

        // Custom Y offset for line start (from data attribute)
        const lineOffsetY = parseInt(card.dataset.lineOffsetY) || 0;

        if (connectsCard) {
            // Talk connecting to another card
            // Stagger connection points for multiple talks connecting to same card
            const allTalksToSameCard = document.querySelectorAll(`.gantt-card[data-connects-card="${connectsCard}"]`);
            let talkIndex = 0;
            allTalksToSameCard.forEach((t, i) => { if (t === card) talkIndex = i; });
            const staggerOffset = talkIndex * 15; // 15px vertical stagger

            if (isLeft) {
                // Left talk connecting to a card on its right
                cardX = cardRect.right - timelineRect.left + dotOffset;
                cardY = cardRect.top - timelineRect.top + 10 + lineOffsetY;
                targetX = targetRect.left - timelineRect.left - dotOffset;
                targetY = targetRect.top - timelineRect.top + 10 + staggerOffset;
            } else {
                // Right talk connecting to a card on its left
                cardX = cardRect.left - timelineRect.left - dotOffset;
                cardY = cardRect.top - timelineRect.top + 10 + lineOffsetY;
                targetX = targetRect.right - timelineRect.left + dotOffset;
                targetY = targetRect.top - timelineRect.top + 10 + staggerOffset;
            }
        } else if (isLeft) {
            // Left card: connect from right edge of card (with offset) to center of bar
            cardX = cardRect.right - timelineRect.left + dotOffset;
            cardY = cardRect.top - timelineRect.top + 10; // Offset to title area
            targetX = targetRect.left - timelineRect.left + targetRect.width / 2;
            targetY = targetRect.top - timelineRect.top + targetRect.height / 2; // CENTER of bar
        } else {
            // Right card: connect from left edge of card (with offset) to center of bar
            cardX = cardRect.left - timelineRect.left - dotOffset;
            cardY = cardRect.top - timelineRect.top + 10;
            targetX = targetRect.left - timelineRect.left + targetRect.width / 2;
            targetY = targetRect.top - timelineRect.top + targetRect.height / 2; // CENTER of bar
        }

        // Create the path
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', `M ${cardX} ${cardY} L ${targetX} ${targetY}`);
        path.setAttribute('stroke', colors[cat]);
        path.setAttribute('stroke-width', '1.5');
        path.setAttribute('fill', 'none');
        path.setAttribute('data-from', id);

        // Talks get dashed lines and lower opacity
        if (cat === 'talks') {
            path.setAttribute('stroke-dasharray', '3,2');
            path.setAttribute('opacity', '0.6');
        } else {
            path.setAttribute('opacity', '0.5');
        }

        // Add endpoint circles
        const cardDot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        cardDot.setAttribute('cx', cardX);
        cardDot.setAttribute('cy', cardY);
        cardDot.setAttribute('r', cat === 'talks' ? '2.5' : '3');
        cardDot.setAttribute('fill', colors[cat]);
        cardDot.setAttribute('data-from', id);

        const targetDot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        targetDot.setAttribute('cx', targetX);
        targetDot.setAttribute('cy', targetY);
        targetDot.setAttribute('r', cat === 'talks' ? '2.5' : '3');
        targetDot.setAttribute('fill', colors[cat]);
        targetDot.setAttribute('data-from', id);

        svg.appendChild(path);
        svg.appendChild(cardDot);
        svg.appendChild(targetDot);
    });
}

// Run on load and resize
window.addEventListener('load', drawConnectors);
window.addEventListener('resize', drawConnectors);
// Also run after a short delay to ensure layout is complete
setTimeout(drawConnectors, 100);

// Hover highlighting
function setupHoverHighlighting() {
    const timeline = document.querySelector('.gantt-timeline');
    const cards = document.querySelectorAll('.gantt-card[data-id]');
    const bars = document.querySelectorAll('.bar[data-id]');

    function clearHighlights() {
        timeline.classList.remove('has-hover');
        document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
    }

    function highlightChain(card) {
        timeline.classList.add('has-hover');
        const id = card.dataset.id;
        const connectsCard = card.dataset.connectsCard;

        // Highlight the hovered card
        card.classList.add('highlight');

        // Highlight its bar (if it has one)
        const bar = document.querySelector(`.bar[data-id="${id}"]`);
        if (bar) bar.classList.add('highlight');

        // Highlight connector lines for this card
        document.querySelectorAll(`.gantt-connectors path[data-from="${id}"], .gantt-connectors circle[data-from="${id}"]`).forEach(el => {
            el.classList.add('highlight');
        });

        // If it's a talk that connects to another card, highlight that chain too
        if (connectsCard) {
            const targetCard = document.querySelector(`.gantt-card[data-id="${connectsCard}"]`);
            if (targetCard) {
                targetCard.classList.add('highlight');
                // And highlight the target's bar
                const targetBar = document.querySelector(`.bar[data-id="${connectsCard}"]`);
                if (targetBar) targetBar.classList.add('highlight');
                // And the target's connector lines
                document.querySelectorAll(`.gantt-connectors path[data-from="${connectsCard}"], .gantt-connectors circle[data-from="${connectsCard}"]`).forEach(el => {
                    el.classList.add('highlight');
                });
            }
        }

        // Also highlight any talks that connect to this card (reverse direction)
        document.querySelectorAll(`.gantt-card[data-connects-card="${id}"]`).forEach(talk => {
            talk.classList.add('highlight');
            const talkId = talk.dataset.id;
            document.querySelectorAll(`.gantt-connectors path[data-from="${talkId}"], .gantt-connectors circle[data-from="${talkId}"]`).forEach(el => {
                el.classList.add('highlight');
            });
        });
    }

    function highlightBar(bar) {
        timeline.classList.add('has-hover');
        const id = bar.dataset.id;

        // Highlight the bar
        bar.classList.add('highlight');

        // Highlight its card
        const card = document.querySelector(`.gantt-card[data-id="${id}"]`);
        if (card) card.classList.add('highlight');

        // Highlight connector lines
        document.querySelectorAll(`.gantt-connectors path[data-from="${id}"], .gantt-connectors circle[data-from="${id}"]`).forEach(el => {
            el.classList.add('highlight');
        });

        // Also highlight any talks that connect to this card
        document.querySelectorAll(`.gantt-card[data-connects-card="${id}"]`).forEach(talk => {
            talk.classList.add('highlight');
            const talkId = talk.dataset.id;
            document.querySelectorAll(`.gantt-connectors path[data-from="${talkId}"], .gantt-connectors circle[data-from="${talkId}"]`).forEach(el => {
                el.classList.add('highlight');
            });
        });
    }

    cards.forEach(card => {
        card.addEventListener('mouseenter', () => highlightChain(card));
        card.addEventListener('mouseleave', clearHighlights);
    });

    bars.forEach(bar => {
        bar.addEventListener('mouseenter', () => highlightBar(bar));
        bar.addEventListener('mouseleave', clearHighlights);
    });
}

window.addEventListener('load', setupHoverHighlighting);
</script>

{% endblock content %}
